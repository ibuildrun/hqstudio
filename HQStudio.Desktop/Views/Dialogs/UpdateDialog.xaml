<Window x:Class="HQStudio.Views.Dialogs.UpdateDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:HQStudio.ViewModels"
        Title="ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ HQ Studio" 
        Height="400" Width="500"
        WindowStartupLocation="CenterOwner"
        ResizeMode="NoResize"
        Background="{DynamicResource BackgroundBrush}"
        KeyDown="Window_KeyDown">
    
    <Window.DataContext>
        <vm:UpdateViewModel/>
    </Window.DataContext>
    
    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Ð—Ð°Ð³Ð¾Ð»Ð¾Ð²Ð¾Ðº -->
        <StackPanel Grid.Row="0" Margin="0,0,0,20">
            <TextBlock Text="ðŸ”„ ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ" 
                       FontSize="20" FontWeight="Bold"
                       Foreground="{DynamicResource ForegroundBrush}"/>
            <TextBlock Text="{Binding StatusMessage}" 
                       Foreground="{DynamicResource SecondaryForegroundBrush}"
                       Margin="0,5,0,0"/>
        </StackPanel>

        <!-- Ð˜Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð²ÐµÑ€ÑÐ¸ÑÑ… -->
        <Grid Grid.Row="1" Margin="0,0,0,15">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <StackPanel Grid.Column="0" HorizontalAlignment="Center">
                <TextBlock Text="Ð¢ÐµÐºÑƒÑ‰Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ" 
                           Foreground="{DynamicResource SecondaryForegroundBrush}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding CurrentVersion}" 
                           FontSize="18" FontWeight="SemiBold"
                           Foreground="{DynamicResource ForegroundBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>

            <TextBlock Grid.Column="1" Text="â†’" FontSize="24" 
                       VerticalAlignment="Center" Margin="20,0"
                       Foreground="{DynamicResource AccentBrush}"
                       Visibility="{Binding UpdateAvailable, Converter={StaticResource BoolToVisibilityConverter}}"/>

            <StackPanel Grid.Column="2" HorizontalAlignment="Center"
                        Visibility="{Binding UpdateAvailable, Converter={StaticResource BoolToVisibilityConverter}}">
                <TextBlock Text="ÐÐ¾Ð²Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ" 
                           Foreground="{DynamicResource SecondaryForegroundBrush}"
                           HorizontalAlignment="Center"/>
                <TextBlock Text="{Binding NewVersion}" 
                           FontSize="18" FontWeight="SemiBold"
                           Foreground="{DynamicResource AccentBrush}"
                           HorizontalAlignment="Center"/>
            </StackPanel>
        </Grid>

        <!-- ÐžÐ¿Ð¸ÑÐ°Ð½Ð¸Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ -->
        <Border Grid.Row="2" 
                Background="{DynamicResource CardBackgroundBrush}"
                CornerRadius="8" Padding="15"
                Visibility="{Binding UpdateAvailable, Converter={StaticResource BoolToVisibilityConverter}}">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <StackPanel>
                    <TextBlock Text="Ð§Ñ‚Ð¾ Ð½Ð¾Ð²Ð¾Ð³Ð¾:" FontWeight="SemiBold" 
                               Foreground="{DynamicResource ForegroundBrush}"
                               Margin="0,0,0,10"/>
                    <TextBlock Text="{Binding ReleaseNotes}" 
                               TextWrapping="Wrap"
                               Foreground="{DynamicResource SecondaryForegroundBrush}"/>
                    
                    <StackPanel Orientation="Horizontal" Margin="0,15,0,0">
                        <TextBlock Text="Ð Ð°Ð·Ð¼ÐµÑ€: " 
                                   Foreground="{DynamicResource SecondaryForegroundBrush}"/>
                        <TextBlock Text="{Binding FileSize}" 
                                   Foreground="{DynamicResource ForegroundBrush}"/>
                    </StackPanel>
                    
                    <TextBlock Text="âš ï¸ ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ðµ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ" 
                               Foreground="#E74C3C" FontWeight="SemiBold"
                               Margin="0,10,0,0"
                               Visibility="{Binding IsMandatory, Converter={StaticResource BoolToVisibilityConverter}}"/>
                </StackPanel>
            </ScrollViewer>
        </Border>

        <!-- ÐŸÑ€Ð¾Ð³Ñ€ÐµÑÑ ÑÐºÐ°Ñ‡Ð¸Ð²Ð°Ð½Ð¸Ñ -->
        <StackPanel Grid.Row="3" Margin="0,15,0,0"
                    Visibility="{Binding IsDownloading, Converter={StaticResource BoolToVisibilityConverter}}">
            <ProgressBar Value="{Binding DownloadProgress}" 
                         Height="8" 
                         Foreground="{DynamicResource AccentBrush}"/>
            <TextBlock Text="{Binding DownloadProgress, StringFormat={}{0:F0}%}" 
                       HorizontalAlignment="Center" Margin="0,5,0,0"
                       Foreground="{DynamicResource SecondaryForegroundBrush}"/>
        </StackPanel>

        <!-- ÐšÐ½Ð¾Ð¿ÐºÐ¸ -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" 
                    HorizontalAlignment="Right" Margin="0,20,0,0">
            
            <Button Content="ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ" 
                    Command="{Binding CheckUpdatesCommand}"
                    Padding="15,10" Margin="0,0,10,0"
                    Visibility="{Binding UpdateAvailable, Converter={StaticResource InverseBoolToVisibilityConverter}}"/>
            
            <Button Content="ðŸ“¥ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ" 
                    Command="{Binding InstallUpdateCommand}"
                    Padding="15,10" Margin="0,0,10,0"
                    Background="{DynamicResource AccentBrush}"
                    Foreground="White"
                    Visibility="{Binding UpdateAvailable, Converter={StaticResource BoolToVisibilityConverter}}"/>
            
            <Button Content="ÐŸÐ¾Ð·Ð¶Ðµ" 
                    Click="CloseButton_Click"
                    Padding="15,10"
                    IsEnabled="{Binding IsMandatory, Converter={StaticResource InverseBoolConverter}}"
                    IsCancel="True"/>
        </StackPanel>

        <!-- Ð˜Ð½Ð´Ð¸ÐºÐ°Ñ‚Ð¾Ñ€ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ -->
        <StackPanel Grid.RowSpan="5" 
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    Visibility="{Binding IsChecking, Converter={StaticResource BoolToVisibilityConverter}}">
            <ProgressBar IsIndeterminate="True" Width="200" Height="4"/>
            <TextBlock Text="ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹..." 
                       HorizontalAlignment="Center" Margin="0,10,0,0"
                       Foreground="{DynamicResource SecondaryForegroundBrush}"/>
        </StackPanel>
    </Grid>
</Window>
