# ADR-010: Offline-first для Desktop

**Дата**: 2025-06-01
**Статус**: Accepted

## Контекст

Desktop CRM используется в автосервисе, где интернет может быть нестабильным. Необходимо обеспечить работу без подключения к API.

Варианты:
1. **Online-only** — требуется постоянное подключение
2. **Offline-first** — локальное хранение с синхронизацией
3. **Hybrid** — кэширование с fallback

## Решение

Выбран **Offline-first** подход:

1. **Локальный кэш**: данные хранятся в JSON файлах
2. **Очередь операций**: изменения сохраняются локально
3. **Синхронизация**: при восстановлении связи
4. **Конфликты**: last-write-wins стратегия

Компоненты:
- `ApiCacheService` — кэширование ответов API
- `OfflineSyncService` — очередь операций
- `DataSyncService` — синхронизация данных

## Последствия

### Положительные

- **Доступность**: работа без интернета
- **Скорость**: мгновенный отклик из кэша
- **Надёжность**: данные не теряются при сбоях сети
- **UX**: пользователь не ждёт сеть

### Отрицательные

- **Сложность**: логика синхронизации
- **Конфликты**: возможны при одновременном редактировании
- **Место**: локальное хранение занимает диск
- **Консистентность**: данные могут быть устаревшими

### Нейтральные

- Индикатор статуса подключения в UI
- Ручная синхронизация по кнопке
- Автоматическая синхронизация при восстановлении связи

## Связанные решения

- [ADR-004](004-desktop-framework.md) — WPF для Desktop
